## 11. TEE Device Interface Security Protocol (TDISP)

Trusted Execution Environments (TEEs) that include a composition of resources
from one or more devices and the host require mechanisms to establish and manage
trust relationships. Here we will use the term TEE-I/O to refer to a conceptual
framework for performing such operations. This chapter defines a specific
architecture for hosts and devices to participate in TEE-I/O (see § Figure 11-1)
.

TEE-I/O builds upon existing capabilities for the direct assignment of devices
to VMs, such as SR-IOV and SIOV (§ Chapter 9. ) and ATS (§ Chapter 10. ), to
establish Trusted Execution Environment VMs (TVMs). All VMs that are not TVMs
are referred to as legacy VMs. In TEE-I/O, the VMM itself may not be trusted by
TVMs, and mechanisms are provided to enable the TVM to make trust decisions
based on the underlying hardware it is using. Although the VMM is not required
to be trusted by TVMs, it continues to perform the resource allocation and
system management functions as it does in non-TEE-I/O use models, but in such a
way that the results can be tested. The VMM can be blocked from bypassing the
security of the affected TVM(s). Legacy VMs that implicitly trust the VMM may
co-exist with TVMs in a system.

![TEE_IO_ENV](pic/TEE_IO_ENV.png)

The **TEE Security Manager (TSM)** is a logical entity in a host that is in the
TCB for a TVM and enforces security policies on the host. The Device Security
Manager (DSM) is a logical entity in the device that may be admitted into the
TCB for a TVM by the TSM and enforces security policies on the device.

The TEE Device Interface (TDI) Security Protocol (TDISP) defines an architecture
for devices that support TEE-I/O virtualization, providing the following
functions:

1. Establishing a trust relationship between a TVM and a device.
2. Securing the interconnect between the host and device.
3. Attach and detach a TDI to a TVM in a trusted manner.

Although TDISP has been defined in relation to TEE-I/O as describe above, TDISP
stands alone as a specification for devices, and such devices may be operated in
systems using security architectures other than TEE-I/O, provided that the host
functions required by TDISP are supported in an appropriate way by the system.

TDISP defines requirements for TDIs specifically, and also for the entire Device
implementing TDIs, where in a specific instance, a TDI may be an entire Device,
a non-IOV Function, a PF (and possibly its subordinate VFs or SDIs), a VF, or an
SDI. Although it is permitted (and generally expected) that TDIs will be
implemented such that they can be assigned to Legacy VMs, such use is not the
focus of TDISP.

### 11.1 Overview of the TEE-I/O Security Model as it Relates to Devices

The TEE-I/O security model is primarily intended to apply to systems using
device resources directly assigned to VMs, and this chapter generally assumes
this use case. However, devices that are compliant to TDISP can potentially be
used in other ways, and such use is not prohibited, although it is outside the
scope of this specification.

The TEE-I/O considers all resources, including memory of all types, host
processors, TDI’s and, in some cases internal state, to be in one of two classes:

* “TEE-assignable” resources have the required trust/security capabilities to
  be assigned to a TEE. Once assigned to a TEE, these resources become
  “TEE-Owned.”

* “Non-TEE-assignable” resources either do not possess the required
  trust/security capabilities to be assigned to a TEE or have been excluded by
  some implementation specific mechanism. These resources may, and often do,
  have a critical role in system function, and therefore it is often desirable
  to appropriately secure them, although how this is done is outside the scope
  of this specification.

The TEE-I/O security model does not require the VMM to be trusted by TVMs. Therefore, devices supporting hardware-assisted I/O virtualization (e.g., SR-IOV) require security extensions to ensure that the device’s virtualization model does not allow or require intervention by software outside the TVM trust boundary to perform operations that affect the confidentiality and/or integrity of TVM data in-flight or at-rest in the device. The primary focus of TDISP is to define the requirements for TDISP-compliant devices and the necessary elements outside of such devices required to support the TDISP architecture. Additional system capabilities required are outside the scope of TDISP.
TVM data, code, and execution state stored in an assigned device must be protected against:
• Confidentiality breaches: read access by entities (firmware, software, or hardware) not in the TCB of the TVM (such as other TVMs, VMM, etc.).
• Integrity: modification by entities (firmware, software, or hardware) not in the TCB of the TVM (such as other TVMs, VMM, etc.).
This security model does not require protection of TVMs against denial-of-service attacks in general. However, systems may impose a requirement that a TVM not have the ability to cause denial of service to other TVMs, VMM, or other VMs executing on the platform. The TSM by itself may not have all the capabilities needed to defend the platform against denial of service. Enforcing this property is the collective responsibility of the TSM, VMM, device and DSM, and is outside the scope of this specification.
The hardware assisted I/O virtualization schemes for direct I/O from TVMs to devices must address the following to preserve the confidentiality and integrity of the TVMs and the data moved between the TVMs and devices:
