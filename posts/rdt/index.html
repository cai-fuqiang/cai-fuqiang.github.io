<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="rdt – intel spec" /><meta name="author" content="fuqiang" /><meta property="og:locale" content="en" /><meta name="description" content="A minimal, responsive and feature-rich Jekyll theme for technical writing." /><meta property="og:description" content="A minimal, responsive and feature-rich Jekyll theme for technical writing." /><link rel="canonical" href="/posts/rdt/" /><meta property="og:url" content="/posts/rdt/" /><meta property="og:site_name" content="one step at a time" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-02-10T15:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="rdt – intel spec" /><meta name="twitter:site" content="@fuqiang_cai" /><meta name="twitter:creator" content="@fuqiang" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"fuqiang"},"dateModified":"2025-02-10T15:00:00+08:00","datePublished":"2025-02-10T15:00:00+08:00","description":"A minimal, responsive and feature-rich Jekyll theme for technical writing.","headline":"rdt – intel spec","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/rdt/"},"url":"/posts/rdt/"}</script><title>rdt -- intel spec | one step at a time</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="one step at a time"><meta name="application-name" content="one step at a time"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="preconnect" href="https://cdnjs.cloudflare.com" ><link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return 'mode'; } static get MODE_ATTR() { return 'data-mode'; } static get DARK_MODE() { return 'dark'; } static get LIGHT_MODE() { return 'light'; } static get ID() { return 'mode-toggle'; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia('(prefers-color-scheme: dark)'); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { document.documentElement.removeAttribute(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage( { direction: ModeToggle.ID, message: this.modeStatus }, '*' ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"></a><h1 class="site-title"> <a href="/">one step at a time</a></h1><p class="site-subtitle fst-italic mb-0">a noob's growing diary</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/cai-fuqiang" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/fuqiang_cai" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['iwng86','163.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>rdt -- intel spec</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1"><header><h1 data-toc-skip>rdt -- intel spec</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1739170800" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Feb 10, 2025 </time> </span><div class="d-flex justify-content-between"> <span> By <em> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="4204 words" > <em>23 min</em> read</span></div></div></div></header><div class="content"><ul><li><a href="#introduce">introduce</a><ul><li><a href="#backgroud">Backgroud</a><li><a href="#main-features">MAIN features</a></ul><li><a href="#overflow">overflow</a><ul><li><a href="#object-(abstract)">object (abstract)</a><li><a href="#concrete-definition">concrete definition</a></ul><li><a href="#monitor">MONITOR</a><ul><li><a href="#cpuid-(eax-0fh)">CPUID (EAX 0FH)</a><li><a href="#ia32_pqr_assoc-rmid-field">IA32_PQR_ASSOC (RMID Field)</a><li><a href="#ia32_qm_evtsel-and-ia32_qm_ctr">IA32_QM_EVTSEL and IA32_QM_CTR</a></ul><li><a href="#control">CONTROL</a><ul><li><a href="#cpuid-(eax 10h)">CPUID (EAX 10H)</a><li><a href="#ia32_pqr_assoc-clos-field">IA32_PQR_ASSOC (CLOS Field)</a><li><a href="#cat">CAT</a><ul><li><a href="#cat-configuration">cat configuration</a><li><a href="#how-cat-work">how cat work</a></ul><li><a href="#cdp">CDP</a><li><a href="#mba">MBA</a></ul><li><a href="#recommended-other-link">Recommended Other Link</a><ul><li><a href="#lecture">Lecture</a><li><a href="#other-blob">other blob</a><li><a href="#linux-foundation">Linux Foundation</a></ul><li><a href="#to-do">TO DO</a><li><a href="#相关链接">相关链接</a></ul><h2 id="introduce"><span class="me-2">introduce</span><a href="#introduce" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Intel RDT技术提供了一种硬件机制，对内存方面的共享资源(例如L2, L3 cache, memory bandwidth) 进行monitor 和 allocate.</p><h3 id="backgroud"><span class="me-2">Backgroud</span><a href="#backgroud" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>资源分配无论在现实生活还是在计算机系统中, 一直有一个难题：</p><p>如何将资源, 进行更合理的分配。而资源分配使用，无非就几种方式:</p><ul><li>share<li>split<li>isolate</ul><p>我们一方希望资源可以被共享，让资源的利用率最大化，另一方面，我们又希望 自己有个独立的资源，用于更频繁的使用，并且不希望别人占用过多的其他公共 资源。所以，我们又希望将资源split，然后isolate。两者在某种程度上是对立的.</p><p>举一个例子。有一个村庄，每个人共享村庄里的土地资源，但是为了更方便的生活， 大家为自己的家庭盖了房子。每个家庭情况不一样，有的家庭物品多，多的放不下， 有的家庭物品少，大部分房间都是空的。这样做看起来空间利用率不是很高， 但是大家找东西方便了，只在自己家找就行了。</p><p>但是，某一天该城市发生了战争，每个村民物资种类不够，有的人种蔬菜，有的人 种粮食，大家需要共享，但是从村南五环到村北五环太远了。于是村长想出了一个 方案，大家都把自己富余物资收集到村委会，由村委会来调配物资，供大家吃饱穿暖。 一开始村委会的策略比较简单，按需分配，大家需要多少就分多少。</p><p>但是有些大聪明耍起了小聪明，每次找村委会要很多物资，吃不了放地库囤着。那大家 肯定不乐意啊，于是大家商量了下，按人头分配，每个人分配到的物资是固定的。这样， 某些村民饭量小，吃不了. 而有些村民饭量大, 吃不够…于是村长又开始新一轮的分配 策略…</p><p>而在计算机的内存子系统来看，也是类似的情况。(甚至与整个计算机体系，一直在share， isolate 中纠结演变), 支持多核的一个很重要的原因，就是为了让多个cpu共享内存, io 等其他资源。但是支持smp后，每个cpu core希望有一个很方便，独占的访问空间， 例如l1, l2 cache. 随着smp core的增加，维护各个cache之间的一致性的代价又很大 (尤其是在多numa场景下). 于是NUMA aware kernel会尽量避免跨numa调度。另外，为 了更方便的维护多个numa之间的cache一致性，同时也为了让IO 设备共享cpu cache， 又将L3 cache作为一个numa上的share cache…</p><p>另外随着单个计算节点的资源越多，其上面的应用更多更复杂，并且随虚拟化技术兴起, 对资源隔离的需求也逐渐增大。而软件层面，Linux 中的cgroup 技术可以对很多资源做隔 离和限制，例如，CPU, memory 使用量, block io 带宽 等等。但是，关于cache, memory bandwidth 等共享资源，由于没有硬件的辅助手段进行monitor 和control， 一直是个空白。</p><p>直到Intel推出了RDT技术。</p><blockquote class="prompt-tip"><p>关于cache和 memory bandwidth 如何在多个cpu core之间，以及cpu core 和 IO 之间共享的，我们在这里简单列个图介绍下，关于更多细节. 请参考, CMU 关于 cache coherence 的相关课程<sup>6,7</sup></p><p><img src="pic/multi-socket-system.png" alt="multi-socket-system" /></p><p>在这个系统中 每个numa上有四个core，每个core独享l1, l2 cache ，每个numa共享l3 cache，每个numa有一个memory control，链接各自的DRAM。而各个numa 之间，使用QPI 进行 interconnect，用来维护cache coherence.</p><p>从这个图中可以看出，关于L3 cache, 其share scope 是一个 numa node, 而memory bandwidth，则是所有cpu core。（虽然 每个numa上的memory controlller 链接各自的DRAM， 但是其他 numa仍然可以通过QPI，来请求该numa上的memory)</p></blockquote><h3 id="main-features"><span class="me-2">MAIN features</span><a href="#main-features" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="#introduce">introduce</a>章节中提到Intel RDT 技术主要围绕两个功能展开:<code class="language-plaintext highlighter-rouge">monitor</code>,<code class="language-plaintext highlighter-rouge">allocate(control)</code>, 而monitor和control的既包括cpu agent（logic cpu core), 也包括 non-cpu agent (io设备DMA也和cpu之间共享cache和memory).</p><blockquote class="prompt-warning"><p>本文暂不介绍non-cpu agent 的相关内容. 之后介绍的所有的内容，都是基于cpu agent。</p></blockquote><p>所以本章节，我们将这两个功能展开，来看下，其提供的一些子功能。</p><ul><li> <font color="red"><strong>monitor</strong></font><div class="table-wrapper"><table><thead><tr><th>feature<th>简称<th>作用<tbody><tr><td>Cache Monitor Technology<td>CMT<td>监控L2/L3 cache的使用<tr><td>Memory BandWidth Monitor<td>MBM<td>监控带宽使用</table></div><li> <font color="red"><strong>control(allocate)</strong></font><div class="table-wrapper"><table><thead><tr><th>feature<th>简称<th>作用<tbody><tr><td>Cache Allocation Technology<td>CAT<td>控制 L2, L3 cache 分配<tr><td>Code and Data Prioritization<td>CDP<td>在L2, L3中icache和dcache是共享的，<br />该功能可以细粒度控制icache/dcache<br />各自的占用<tr><td>Memory BandWidth Allocation<td>MBA<td>控制带宽分配</table></div></ul><p>如前面章节提到的，RDT 其子功能也是围绕着cache，memory ndwidth 共享资源，提供 提供监控和控制能力。</p><h2 id="overflow"><span class="me-2">overflow</span><a href="#overflow" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>无论是monitor还是control，都得为其划分针对的”对象”。而这又 引出了一系列的问题(正如前面所说, 我们仅关注cpu-agent):</p><ul><li>如何规定对象形态? (per-cpu? per-timestamp? per-xxx?)<li>软件如何配置当前cpu上下文是属于哪个对象?<li>软件配置后，硬件如何识别当前访存指令属于哪个对象？</ul><p>该章节，我们围绕”对象”来看下，RDT的控制粒度，以及其大概的实现细节。</p><h3 id="object-abstract"><span class="me-2">object (abstract)</span><a href="#object-abstract" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>RDT 为了让软件可以更灵活的配置，在application 和 logic core 之间定义了一个 抽象层: TAGS。software 可以为logic core 定义不同的tags，然后可以为不同的 application 分配不同的tags, 从而完成不同粒度的监控/控制。</p><p>大体流程，如下图所示:</p><ul><li><p>monitor:</p><p><img src="pic/rdt_monitor_summary.svg" alt="rdt_monitor_summary" /></p><p>软件可以配置当前进程上下文，是属于哪个TAG，然后在切换到该进程时，切换到该TAG， 而资源计数器，也是为每个tag定义了单独的计数器。当进程执行访存指令时，根据其 TAG更新计数器。</p><li><p>control</p><p><img src="pic/rdt_control_summary.svg" alt="rdt_control_summary" /></p><p>一种简单的控制方法是isolate，即为每个对象划定一个资源范围。而RDT中的CAT, CDP就是 这样实现的。从图中可以看到，每个TAG都规定了一个资源范围，其只能访问该范围内的资源。 软件可以自由定义其TAG所属的范围，可以让不同的tag之间是isolate 状态（TAG0， TAG1）， 也可以让其之间又overlap（TAG0/TAG1 和 TAG2)</p><blockquote class="prompt-tip"><p>cache和memory bandwidth的控制策略不同，cache使用的是isolate的策略，而memory control 则是delay.</p></blockquote></ul><p>上面我们抽象的介绍了TAG, 下面我们来看下手册中的具体定义</p><h3 id="concrete-definition"><span class="me-2">concrete definition</span><a href="#concrete-definition" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>针对monitor和control功能，RDT定义了不同的TAG.</p><div class="table-wrapper"><table><thead><tr><th>TAG<th>简称<th>FOR<tbody><tr><td>Resource Monitoring IDs<td>RMIDs<td>monitor<tr><td>Classes of Sevice<td>CLOS<td>resource</table></div><p>software 可以通过MSR <code class="language-plaintext highlighter-rouge">IA32_QM_EVTSEL</code> 来配置当前logic cpu context所属的 CLOS/RMID</p><p><img src="pic/ia32_pqr_assoc_MSR.png" alt="ia32_pqr_assoc_MSR" /></p><p>接下来，我们来分章节来看下，RDT monitor/control 子功能所其他细节。</p><h2 id="monitor"><span class="me-2">MONITOR</span><a href="#monitor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>软件侧使用monitor 功能 的大致流程如下:</p><p><img src="pic/RDT_monitor_hardware_func.png" alt="RDT_monitor_hardware_func" /></p><ol><li>通过CPUID/ACPI 来获取RDT 支持的features，以及支持RMIDs的总数量<li>software 可以通过某种方式来配置当前的RMID<li>允许软件通过MSRs/MMIO 来收集monitor stats</ol><p>我们来看下具体实现:</p><ul><li>CPUID: EAX=0xf, ECS=0x0, 0x1<li>specfy RMID: <code class="language-plaintext highlighter-rouge">IA32_PQR_ASSOC</code><li>collect event stats: <code class="language-plaintext highlighter-rouge">IA32_QM_EVTSEL</code>, <code class="language-plaintext highlighter-rouge">IA32_QM_CTR</code></ul><h3 id="cpuid-eax-0fh"><span class="me-2">CPUID (EAX 0FH)</span><a href="#cpuid-eax-0fh" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>CPUID.EAX[0x0F]有两个分支来展示RDT相关feature.</p><details open=""> <summary>展开</summary><p><img src="pic/CPUID_EAX_F_ECX_0.png" alt="CPUID_EAX_F_ECX_0" /></p><p><img src="pic/CPUID_EAX_F_ECX_1.png" alt="CPUID_EAX_F_ECX_1" /></p><p><img src="pic/CPUID_EAX_F_ECX_1_EDX.png" alt="CPUID_EAX_F_ECX_1_EDX" /></p><ul><li>RMIDs numbers:<ul><li><code class="language-plaintext highlighter-rouge">CPUID.(EAX=0FH, ECX=1H).EBX</code> reports the highest RMID value of any resource type that supports monitoring in the processor.<li><code class="language-plaintext highlighter-rouge">CPUID.(EAX=0FH, ECX=1H).ECX</code> enumerates the highest RMID value that can be monitored with this resource type, see Figure 18-21.</ul><li>support Non-CPU features: <code class="language-plaintext highlighter-rouge">CPUID.(EAX=0FH, ECX=1H).EAX[bit 9,10]</code><ul><li>bit 9: Non-CPU Agent Cache Occupancy Monitoring<li>bit 10: Non-CPU Agent Memory L3 External Bandwidth Monitoring</ul><li>support EventType mask: <code class="language-plaintext highlighter-rouge">CPUID.(EAX=0FH, ECX=1H).EDX[bit 0, 1, 2]</code></ul><p>在<a href="#ia32_qm_evtsel-and-ia32_qm_ctr">IA32_QM_EVTSEL and IA32_QM_CTR</a> 列举各个Event Type对应的EventID值, 以及其对应的feature</p></details><h3 id="ia32_pqr_assoc-rmid-field"><span class="me-2">IA32_PQR_ASSOC (RMID Field)</span><a href="#ia32_pqr_assoc-rmid-field" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">IA32_PQR_ASSOC</code>我们在<a href="#concrete-definition">concrete definition</a>章节介绍过, 在<code class="language-plaintext highlighter-rouge">MONITOR</code> 相关功能中, 软件需要配置其<code class="language-plaintext highlighter-rouge">RMID</code> Field 来标记 当前CPU上下文。</p><p><img src="pic/IA32_PQR_ASSOC_MSR_RMID.png" alt="IA32_PQR_ASSOC_MSR_RMID" /></p><h3 id="ia32_qm_evtsel-and-ia32_qm_ctr"><span class="me-2">IA32_QM_EVTSEL and IA32_QM_CTR</span><a href="#ia32_qm_evtsel-and-ia32_qm_ctr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img src="pic/QM_EVTSEL_QM_CTR.png" alt="QM_EVTSEL_QM_CTR" /></p><p>Software通过设置<code class="language-plaintext highlighter-rouge">IA32_QM_EVTSEL</code> MSR，来选择要collect的RMID 和EventID, 并通过<code class="language-plaintext highlighter-rouge">IA32_QM_CTR</code>进行query.</p><p>eventid 值如下:</p><p><img src="pic/Monitor_supported_Event_ID.png" alt="Monitor_supported_Event_ID" /></p><ul><li>CMT: <code class="language-plaintext highlighter-rouge">L3 cache occupancy</code><li>MBM: <code class="language-plaintext highlighter-rouge">L3 Total External Bandwidth</code> and <code class="language-plaintext highlighter-rouge">L3 Local External Bandwidth</code></ul><blockquote class="prompt-tip"><p>关于L3 local/total BW , 我们可以简单认为，某个CPU访存，触发 了L3 cache miss, 如果其访存地址位于local memory, 记录到L3 local/total BW 中; 如果其访存地址位于remote memory, 则只记录到 L3 total BW 中.</p><p>如果要继续深入理解L3 Total External Bandwidth/L3 local External Bandwidth 推荐走读CMU directory-based cache coherence 相关课程.<sup>6</sup></p></blockquote><h2 id="control"><span class="me-2">CONTROL</span><a href="#control" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>其软件侧整体的使用流程方式和monitor功能很相似，我们来看下:</p><p><img src="pic/RDT_allocate_hardware_func.png" alt="RDT_allocate_hardware_func" /></p><ol><li>通过CPUID/ACPI 获取RDT支持的feature，以及支持的CLOS总数量<li>software 可以通过某种方式配置当前CLOS<li>允许软件通过MSR/MMIO 来进一步配置每个CLOS的资源</ol><h3 id="cpuid-eax-10h"><span class="me-2">CPUID (EAX 10H)</span><a href="#cpuid-eax-10h" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>CPUID.EAX[0x10].ECX[0]: 用来enum哪些sub-feature支持, eg:<ul><li>EBX[bit 0]: res<li>EBX[bit 1]: l3 cat<li>EBX[bit 2]: l2 cat<li>EBX[bit 3]: mba</ul><li>CPUID.EAX[0x10].ECX[1]: 用来enum l3 cat<li>CPUID.EAX[0x10].ECS[2]: 用来enum l2 cat</ul><p>我们这里只展示下, l3 cat:</p><p><img src="pic/cpuid_eax_10_ecx_1_l3_part1.png" alt="cpuid_eax_10_ecx_1_l3_part1" /> <img src="pic/cpuid_eax_10_ecx_1_l3_part2.png" alt="cpuid_eax_10_ecx_1_l3_part2" /></p><ul><li>EDX: 表示 highest CLOS number.<li>ECS[bit 2]: 表示是否支持l3 cdp<li>ECX[bit 3]: 表示cbm中的bit是否支持不连续，例如0x5(101b)是不连续的，0x6(110b)是连续的。<li>EAX[bit 4-0]: cbm len</ul><h3 id="ia32_pqr_assoc-clos-field"><span class="me-2">IA32_PQR_ASSOC (CLOS Field)</span><a href="#ia32_pqr_assoc-clos-field" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>CAT和MBA 都使用 CLOS 最为TAG。前面提到过，和RMID一样，软件 可以通过配置 <code class="language-plaintext highlighter-rouge">IA32_PQR_ASSOC</code> MSR中的CLOS Field, 来决定当前 CPU的CLOS.</p><p><img src="pic/IA32_PQR_ASSOC_CLOS.png" alt="IA32_PQR_ASSOC_CLOS" /></p><p>关于具体的feature，其他配置方法，我们分别来看下:</p><h3 id="cat"><span class="me-2">CAT</span><a href="#cat" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>我们先来看下CAT可以达到的效果:</p><p><img src="pic/with_CAT_vs_without_CAT.png" alt="with_CAT_vs_without_CAT" /></p><p>在没有cat时，某些低优先级的 application会和高优先级application共享LLC， 甚至低优先级应用在短时间内访问大量内存后，其会争抢到跟多的cache。</p><p>但是有了cat之后，限制低优先级应用的cache使用量。</p><h4 id="cat-configuration"><span class="me-2">cat configuration</span><a href="#cat-configuration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>前面提到，<code class="language-plaintext highlighter-rouge">IA32_PQR_ASSOC</code>中的CLOS决定了要control的对象。而<code class="language-plaintext highlighter-rouge">capacity bitmap</code>(CBM) 则决定了不同的CLOS分配的cache的区域。</p><p><img src="pic/example_of_cmb_usage.png" alt="example_of_cmb_usage" /></p><p>图中的每个bit可以认为一块cache资源，A 表示allocate给横轴的clos。</p><ul><li>in default bitmask，所有clos都分配了全部的cache，大家共享所有cache。<li>in overlappd bitmask, cache of <code class="language-plaintext highlighter-rouge">clos0 ∈ clos1 ∈ clos2 ∈ clos3</code><li>in isolated bitmap, clos0, clos1, clos2, clos3 都使用独立的cache。互不冲突，其中 cache size of ( <code class="language-plaintext highlighter-rouge">clos0 = 2clos1 = 4 clos2 = 4 clos3</code>)</ul><font color="red"><strong>cbm 配置</strong></font><p>根据cat作用的对象不同，cbm配置的MSR也不同</p><ul><li>L3 CBM: IA32_L3_MASK_n MSR: “n” is the Class of Service,<li>L2 CBM: IA32_L2_MASK_n</ul><p>cat 相关的msr如下图:</p><p><img src="pic/IA32_PQR_ASSOC_AND_IA32_L3_MASK.png" alt="IA32_PQR_ASSOC_AND_IA32_L3_MASK" /></p><p><img src="pic/IA32_L2_MASK_n.png" alt="IA32_L2_MASK_n" /></p><font color="red"><strong>cbm 是怎么作用于cat 功能的?</strong></font><h4 id="how-cat-work"><span class="me-2">how cat work</span><a href="#how-cat-work" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>我们很容易想到，是不是基于way做的，我们首先回顾下，cache的组相连<sup>7,8</sup>:</p><p><img src="pic/i7_l1_data_cache.png" alt="i7_l1_data_cache" /></p><p><img src="pic/unknown_cpu_cache.png" alt="unknown_cpu_cache" /></p><p>图片中描述的是某牙膏厂某代i7 l1 data cache和另一张不知名cpu的cache图，用来更方便 的看per-way cache, 具体参数如下(第一个图):</p><ul><li>B=64: 每个block(cache line data part)为大小64byte<li>E=8: 一共有8-way<li>S=64: 每个1-way有64 个block<li>cache line 总大小: 64 * 64 * 8 = 32 kbyte</ul><p>每个地址可以分为三部分来索引cache.</p><ul><li>set index: 用来选择哪个way<li>tag: 在每一way中选择具体的cache line<li>block index: 在每个cache line中选择offset</ul><p>那么，当一个地址确定时，其way index，block index已经确定，而变数就是该way中的 index. 该mask 主要用来确定，在该way中能够选择哪些 cacheline 来缓存该物理内存. 类似于再确定一个sub-way.</p><p>我们来看看手册中的描述:</p><blockquote><p>It is generally expected that in way-based implementations, one capacity mask bit corresponds to some number of ways in cache, but the specific mapping is implementation-dependent. In all cases, a mask bit set to ‘1’ specifies that a particular Class of Service can allocate into the cache subset represented by that bit. A value of ‘0’ in a mask bit specifies that a Class of Service cannot allocate into the given cache subset. In general, allocating more cache to a given application is usually beneficial to its performance.</p></blockquote><p>手册中的意思是，一般猜测认为，可能是way-based的实现方式（除了address中的set index, 还使用 cbm 在确定一个sub-way。但是手册中提到，这个cbm和sub-way的关系是 implementation- dependent.</p><p>下图中也展示了这个大致的实现:</p><p><img src="pic/clos_and_cbm.png" alt="clos_and_cbm" /></p><p>手册中关于该图片的解释:</p><blockquote><p>The currently running application’s Class of Service is communicated to the hardware through the per-logical- processor PQR MSR (IA32_PQR_ASSOC MSR). When the OS schedules an application thread on a logical processor, the application thread is associated with a specific CLOS (i.e., the corresponding CLOS in the PQR) and all requests to the CAT-capable resource from that logical processor are tagged with that CLOS (in other words, the application thread is configured to belong to a specific CLOS). The cache su\bsystem uses this tagged request information to enforce QoS. The capacity bitmask may be mapped into a way bitmask (or a similar enforcement entity based on the implementation) at the cache before it is applied to the allocation policy. For example, the capacity bitmask can be an 8-bit mask and the enforcement may be accomplished using a 16-way bitmask for a cache enforcement implementation based on way partitioning.</p></blockquote><p>大概的意思是，当OS调度器调度到一个thread时, 会切换到属于该thread的PQR MSR, 表明 该thread属于这个CLOS。之后对 CAT-capable 资源的所有访问，都会被 tag上该 CLOS. 而 cache subsystem 会根据 该tag 来 enforce QoS。另外，cbm可能会映射成一个way bitmap. 例如从上图来看，cbm 又8bit，但是每个cache set 却有16-way, 所以两者有一个对应关系。</p><h3 id="cdp"><span class="me-2">CDP</span><a href="#cdp" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>CDP 包括L3 CDP 和 L2CDP, 我们以l3 CDP为例。</p><p>CDP 的作用是在high level cache中(l2, l3) 隔离 icache,dcache。而前面提到的cat也是 isolate cache的作用。所以，cdp 是基于cat 的扩展功能。其做法是，当使能了CDP后， cbm将被split成两组，一组用于data, 一组用于code, 而clos和cbm进行重映射，每个clos 对应两个cbm.</p><p><img src="pic/re-index-clos-number-and-mapping-cbm-msr.png" alt="re-index-clos-number-and-mapping-cbm-msr" /></p><p><img src="pic/code_and_data_cbm_of_cdp.png" alt="code_and_data_cbm_of_cdp" /></p><blockquote><p>对于第二个图，如果clos number 为5，则最后一个不成对的clos4 将不会被cdp使用。</p></blockquote><p>其使能方式比较简单，配置<code class="language-plaintext highlighter-rouge">IA32_L3_QOS_CFG</code>中的bit 0</p><p><img src="pic/LA32_L3_QOS_CFG.png" alt="LA32_L3_QOS_CFG" /></p><p>其工作方式和cat的工作方式相同。</p><h3 id="mba"><span class="me-2">MBA</span><a href="#mba" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>MBA 功能主要是用来限制memory bandwidth，其和cat技术一样, 使用CLOS标记当前throttle 对象。另外使用<code class="language-plaintext highlighter-rouge">IA32_L2_QoS_Ext_BW_Thrtl_xxx</code>来调整该clos 的delay value</p><p><img src="pic/MBA_delay_value_msr.png" alt="MBA_delay_value_msr" /></p><p><img src="pic/IA32_L2_Qos_Ext_BW_Thrtl_n_MSR.png" alt="IA32_L2_Qos_Ext_BW_Thrtl_n_MSR" /></p><p>具体怎么调整细节，包括其达到的效果，在手册中没有找到答案</p><blockquote><p>NOTE</p><p>关于这一部分，手册中描述的比较模糊，所以我们这里只是简单看下如何配置，之后了解 更多细节之后再更新.</p></blockquote><h2 id="recommended-other-link"><span class="me-2">Recommended Other Link</span><a href="#recommended-other-link" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="lecture"><span class="me-2">Lecture</span><a href="#lecture" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>CMU-15418 snoop/directory-based cache coherence<sup>5,6</sup>: 可以 更系统了解cache一致性所面临的挑战，以及其目前的解决方案<li>Onur Mutlu 大神关于memory QoS 课程 – <sup>9</sup><ul><li>L11: Memory Controllers: Service Quality and Performance<li>L13a: Memory Controllers: Service Quality and Performance II</ul></ol><h3 id="other-blob"><span class="me-2">other blob</span><a href="#other-blob" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>苏南里公牛 rdt blob <sup>4</sup>: 由浅入深的介绍了intel rdt的细节，以及源码实现（比我写的好太多)<li>huataihuang rdt blob <sup>3</sup>: 介绍了相关原理以及一些实验部分</ol><h3 id="linux-foundation"><span class="me-2">Linux Foundation</span><a href="#linux-foundation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Intel的FengHua Yu的演讲<sup>10,11</sup>, 由于没有英文字幕，英语不好的慎看，不过大佬口音 还是很chinese的，比较容易听懂。</p><blockquote><p>愿全世界都说中国话</p></blockquote><h2 id="to-do"><span class="me-2">TO DO</span><a href="#to-do" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>该文章中包括了rdt 技术的相关背景和一些原理的猜测部分，之后打算走读Qnur Mutlu<sup>9</sup> 课程，并将这部分内容转移到课程笔记中, 使该文章仅保留intel sdm部分。</p><h2 id="相关链接"><span class="me-2">相关链接</span><a href="#相关链接" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li><a href="https://cdrdv2-public.intel.com/789566/356688-intel-rdt-arch-spec.pdf">Intel® Resource Director Technology (Intel® RDT) Architecture Specification</a><li><a href="https://www.intel.cn/content/www/cn/zh/developer/articles/technical/intel-sdm.html">intel sdm</a><li><a href="https://cloud-atlas.readthedocs.io/zh-cn/latest/kernel/cpu/intel/intel_rdt/intel_rdt_arch.html">Intel Resource Director Technology(RDT) – huataihuang</a><li><a href="https://zhuanlan.zhihu.com/p/678577734">浅度剖析内核 RDT 框架 – 苏里南公牛</a><li><a href="https://www.cs.cmu.edu/afs/cs/academic/class/15418-s22/www/lectures/11_snooping.pdf">Snooping-Based Cache Coherence</a><li><a href="https://www.cs.cmu.edu/afs/cs/academic/class/15418-s22/www/lectures/13_directory_coherence.pdf">Directory-Based Cache Coherence</a><li><a href="https://houmin.cc/posts/9bccd097/">[计算机体系结构] Cache Memory – houmin</a><li><a href="https://my.oschina.net/fileoptions/blog/1630855">Cache 直接映射、组相连映射以及全相连映射</a><li><a href="https://safari.ethz.ch/architecture/fall2024/doku.php?id=schedule">Onur Mutlu 课程(内含youtube链接，以及pdf)</a><li><a href="https://www.youtube.com/watch?v=rKe5_xWpH8o">[youtube]Resource Allocation: Intel Resource Director Technology (RDT) by Fenghua Yu, Intel</a><li><a href="https://events.static.linuxfound.org/sites/events/files/slides/cat8.pdf">[PDF] Resource Allocation: Intel Resource Director Technology (RDT) by Fenghua Yu, Intel</a></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/intel-sdm/">intel_sdm</a>, <a href="/categories/rdt/">rdt</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/intel-sdm/" class="post-tag no-text-decoration" >intel_sdm</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=rdt%20--%20intel%20spec%20-%20one%20step%20at%20a%20time&url=%2Fposts%2Frdt%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=rdt%20--%20intel%20spec%20-%20one%20step%20at%20a%20time&u=%2Fposts%2Frdt%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Frdt%2F&text=rdt%20--%20intel%20spec%20-%20one%20step%20at%20a%20time" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/coherence_basic/">CHAPTER 2 Coherence Basics</a><li class="text-truncate lh-lg"> <a href="/posts/consistency_and_coherence/">CHAPTER 1 Introduction to Consistency and Coherence</a><li class="text-truncate lh-lg"> <a href="/posts/memory-consistency-motivation-and-sequential-consistency/">Memory Consistency Motivation And Sequential Consistency</a><li class="text-truncate lh-lg"> <a href="/posts/svm-overflow/">svm</a><li class="text-truncate lh-lg"> <a href="/posts/amd-sev/">sev</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/virt/">virt</a> <a class="post-tag btn btn-outline-primary" href="/tags/para-virt/">para_virt</a> <a class="post-tag btn btn-outline-primary" href="/tags/autoconverge/">autoconverge</a> <a class="post-tag btn btn-outline-primary" href="/tags/cache/">cache</a> <a class="post-tag btn btn-outline-primary" href="/tags/kvm/">kvm</a> <a class="post-tag btn btn-outline-primary" href="/tags/live-migration/">live_migration</a> <a class="post-tag btn btn-outline-primary" href="/tags/pcie/">pcie</a> <a class="post-tag btn btn-outline-primary" href="/tags/qemu-hot-upgrade/">qemu_hot_upgrade</a> <a class="post-tag btn btn-outline-primary" href="/tags/acs/">acs</a> <a class="post-tag btn btn-outline-primary" href="/tags/amd-sdm/">amd_sdm</a></div></section></div><section id="toc-wrapper" class="ps-0 pe-4"><h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/vm86/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1713753000" data-df="ll" > Apr 22, 2024 </time><h4 class="pt-0 my-2">vm86</h4><div class="text-muted"><p>FROM intel sdm chapter 21 8086 emulation abstract IA-32 processors (beginning with the Intel386 processor) provide two ways to execute new or legacy programs that are assembled and/or compiled t...</p></div></div></a></article><article class="col"> <a href="/posts/pml/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1713841200" data-df="ll" > Apr 23, 2024 </time><h4 class="pt-0 my-2">protected-mode memory management</h4><div class="text-muted"><p>29.3.6 Page-Modification Logging When accessed and dirty flags for EPT are enabled, software can track writes to guest-physical addresses using a feature called page-modification logging. 当启用了...</p></div></div></a></article><article class="col"> <a href="/posts/proctected-mode/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1713841200" data-df="ll" > Apr 23, 2024 </time><h4 class="pt-0 my-2">protected-mode memory management</h4><div class="text-muted"><p>FROM intel sdm CHAPTER 3 PROTECTED-MODE MEMORY MANAGEMENT abstract This chapter describes the Intel 64 and IA-32 architecture’s protected-mode memory management facilities, including the phys...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/dirty-tracking/" class="btn btn-outline-primary" aria-label="Older" ><p>dirty tracking</p></a> <a href="/posts/pqos/" class="btn btn-outline-primary" aria-label="Newer" ><p>qpos -- amd spec</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/fuqiang_cai">fuqiang wang</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v6.5.5" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/virt/">virt</a> <a class="post-tag btn btn-outline-primary" href="/tags/para-virt/">para_virt</a> <a class="post-tag btn btn-outline-primary" href="/tags/autoconverge/">autoconverge</a> <a class="post-tag btn btn-outline-primary" href="/tags/cache/">cache</a> <a class="post-tag btn btn-outline-primary" href="/tags/kvm/">kvm</a> <a class="post-tag btn btn-outline-primary" href="/tags/live-migration/">live_migration</a> <a class="post-tag btn btn-outline-primary" href="/tags/pcie/">pcie</a> <a class="post-tag btn btn-outline-primary" href="/tags/qemu-hot-upgrade/">qemu_hot_upgrade</a> <a class="post-tag btn btn-outline-primary" href="/tags/acs/">acs</a> <a class="post-tag btn btn-outline-primary" href="/tags/amd-sdm/">amd_sdm</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.25.0/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/assets/js/dist/app.min.js"></script> <script> /* Note: dependent library will be loaded in `js-selector.html` */ SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
